<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<title>基本资料1111</title>
		<link href="css/suffer-style.css" rel="stylesheet" type="text/css" />
		<script src="js/font-adjust.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css" media="screen">
			.patient-detail {font-size: 0.32rem;padding: 0.6rem 0 0.5rem 0.3rem;}
			.patient-detail li {list-style: none;height: 0.8rem; line-height: 0.8rem;position:relative;}
			.patient-detail li>label {font-size: 0.27rem;width: 1.3rem;position: absolute;display: inline-block;}
			.patient-detail li input {outline:none;font-size: 0.24rem;border:1px solid rgba(0,0,0,0);width: 4rem;height: 0.5rem;margin-left: 1.5rem;padding-left: 0.1rem;-webkit-transition: box-shadow 0.30s ease-in-out;transition:box-shadow 0.30s ease-in-out;-webkit-tap-highlight-color:rgba(0,0,0,0);
			 }
			.patient-detail .bd_placeholder {position: absolute;font-size: 0.24rem;width: 4rem;height: 100%;color: #c1c1c1;margin-left: 1.5rem;padding-left: 0.1rem;z-index: 0;-webkit-tap-highlight-color:rgba(0,0,0,0);}
			.patient-detail li input:focus{border:1px solid #87C6F9;box-shadow: 0 0 8px rgba(103, 166, 217, 1);}
			.patient-detail li input[type="date"]{position: relative;outline: none;-webkit-appearance: none;background-color: transparent;}
			::-webkit-date-edit-fields-wrapper { background-color: transparent; }
			/*.patient-detail .sex p input:checked+label{background-color: #e8f1fd;color: #1d75f0;}*/
			.patient-detail .sex input,.patient-detail #sexAllergy input {display: none;}
			.patient-detail #sexBtns label,.patient-detail #sexAllergy label {position: relative;display: inline-block;text-align: center;width: 1.46rem;height: 0.6rem;margin:0.1rem 0.2rem 0.2rem 0;line-height: 0.6rem;font-size: 0.24rem; color: #a5a5a5;border-radius: 0.06rem;-webkit-tap-highlight-color:rgba(0,0,0,0);}
			.patient-detail #sexBtns .first,.patient-detail #sexAllergy .first {margin-left: 1.1rem;}
			.patient-detail #sexBtns span,.patient-detail #sexAllergy span {vertical-align: middle;}
			.patient-detail .selected {background: url(images/round-selected.png) no-repeat;}
			.patient-detail .choose {background: url(images/round-choose.png) no-repeat;}
			.patient-detail .selected,.patient-detail .choose {vertical-align: middle;margin: 0 0.2rem 0 0.42rem;-webkit-background-size: 100% 100%;background-size: 100% 100%;width: 0.36rem;height: 0.36rem;display: inline-block;}

		</style>
	</head>
	<body>
		<!-- patient form-->
		<section class="patient-body body-minheight">
			<div class="patient-banner">
				<div class="patient-icon"></div>
				<h1>获得医生更准确地服务 </h1>
				<p>您的个人信息为保密状态，仅医患双方可见</p>
			</div>
			<!-- <form action="" class="patient-form" method="post" accept-charset="utf-8">
				<div class="line">
					<label><span>患者姓名</span><input type="text" id="name" placeholder="请填写患者名字"></label>
				</div>
				<div class="line">
					<label><span>出生年月</span><input type="date" id="yearMth" placeholder="请选择出生年月"></label>
				</div>
				<div class="line">
					<label><span>手机号码</span><input type="text" id="phone" placeholder="手机号用于接收医生回答提醒"></label>
				</div>
				<div class="line">
					<label>
						<span>性别</span>
						<ul id="sex">
							<li value="0"><div class="selected"></div>男</li>
							<li value="1"><div class="choose"></div>女</li>
						</ul>
					</label>
					
				</div>
				<div class="line">
					<label>
						<span>药物过敏</span>
						<ul id="allergy">
							<li value="0"><div class="selected"></div>无</li>
							<li value="1"><div class="choose"></div>有</li>
						</ul>
					</label><br>
					<label style="display: none;"><span>&nbsp;</span><input type="text" id="allergy_detail" style="margin-top: 0.2rem;"placeholder="请输入过敏药物名称"></label>
				</div>
			</form> -->
			<ul class="patient-detail">
				 <li class="bor_bottom_1px"><label>孩子姓名</label><p><input data-filed="name" type="text" placeholder="请填写孩子名字" maxlength="10" minlength="1" /></p></li>
				<li class=""><label>出生年月</label>
					<div id="bd_placeholder" class="bd_placeholder">请选择出生年月</div>
					<p><input id="bd_date" data-filed="birthdate" type="date"/></p>
				</li>
				<li class=""><label>手　　机</label>
					<p><input type="tel" placeholder="手机号用于接收医生回答提醒" /></p>
				</li>
				<li class="sex">
					<label>性　　别</label>
					<p id="sexBtns">
						<input type="radio" name="sex" value="0" id="male" checked="checked"/>
						<label for="male" class="first">
							<span class="selected"></span><span>男</span>
						</label>
						<input type="radio" name="sex" value="1" id="female" />
						<label for="female">
							<span class="choose"></span><span>女</span>
						</label>
						<!-- <input id="sex" type="hidden" data-filed="sex" /> -->
					</p>
				</li>
				<li class="allergy">
					<label>药物过敏</label>
					<p id="sexAllergy">
						<input type="radio" name="no_allergy" value="0" id="no_allergy" checked="checked"/>
						<label for="no_allergy" class="first">
							<span class="selected"></span><span>无</span>
						</label>
						<input type="radio" name="yes_allergy" value="1" id="yes_allergy" />
						<label for="yes_allergy">
							<span class="choose"></span><span>有</span>
						</label>
						<!-- <input id="sex" type="hidden" data-filed="sex" /> -->
					</p>
				</li>
			</ul>
		</section>

		<div class="patient-btn no-handle">
			<a id="sbmt_info" href="#">提交</a>
		</div>

		<script src="js/zepto.js"></script>
		<script src="js/common.js"></script>
		<script>
			(function() {

				 // var bd_date = G('bd_date'),
			  //       bd_placeholder = G('bd_placeholder');
				var bd_date = $('#bd_date'),
			        bd_placeholder = $('#bd_placeholder');
			    bd_placeholder.on('touchstart',function(){
			        bd_date.focus();
			    });

			    bd_date.on('focus',ck_bd_placeholder);
			    bd_date.on('blur',ck_bd_placeholder);
			    bd_date.on('change',ck_bd_placeholder);

			    function ck_bd_placeholder(){
			        bd_placeholder[0].style.display= bd_date.val() ? 'none' : 'block'; 
			    }

				var init = {
					curSufferer : {},
				};
				var check = {
					_nullCheck : function(text,name) {
						if(text === "" || text === null) {
							$("#"+name).prev().addClass("error");
							$("#sbmt_info").parent().addClass("no-handle");
							return false;
						}
						$("#"+name).prev().removeClass("error");
						return true;
					},
					//电话号码的匹配，包括虚拟运营号码比如170等
					_phoneCheck : function(content,name) {
						var reg = /(^(13\d|15[^4,\D]|17[13678]|18\d)\d{8}|170[^346,\D]\d{7})$/;
						if(!reg.test(content)) {
							$("#"+name).prev().addClass("error");
							$("#sbmt_info").parent().addClass("no-handle");
							return false;
						}
						$("#"+name).prev().removeClass("error");
						return true;
					},
					//检查过敏描述为空
					_allergyCheck :function(allergy,name) {
						if(allergy === "" || allergy === null) {
							$("#"+name).prev().addClass("error");
							$("#sbmt_info").parent().addClass("no-handle");
							return false;
						}
						$("#"+name).prev().removeClass("error");
						return true;
					},
				};
				var fn = {
					_getInfo : function(surferer) {
						surferer.name = $("#name").val().trim();
						surferer.yearMth = $("#yearMth").val();
						surferer.phone = $("#phone").val().trim();
						surferer.sex = $("#sex .selected").parent().val();
						surferer.allergy = $("#allergy .selected").parent().val();
					},
					_checkInfo : function(surferer) {
						if(check._nullCheck(surferer.name,"name")) {
							if(check._nullCheck(surferer.yearMth,"yearMth")) {
								if(check._phoneCheck(surferer.phone,"phone")) {
									if(surferer.allergy === 1) {
										surferer.allergyDetl = $("#allergy_detail").val().trim();
										if(check._allergyCheck(surferer.allergyDetl,"allergy")) {
											return true;
										}
										else {
											return false;
										}
									}
									else {
										$("#sbmt_info").parent().removeClass("no-handle");
										console.log(111);
										delete surferer.allergyDetl;
										return true;
									}
								}
							}
						}
						return false;
					},
					//看之前是否有记录患者信息
					_cmtJudge : function(record) {
						if(!record) {
							window.location.href = "disease-desc.html";
						}
						else {
							window.location.href = "sufferer-choose.html";
						}
					},
					//检查输入正确后进行的操作
					_checkSucs : function(record) {
						this._cmtJudge(record);
					},

				};
				//判断是否有错误样式
				var isValidate = function() {
					if($(".error").length === 0) {
						return true;
					}
					return false;
				};

				//性别与过敏与否的选择
				$("#sex,#allergy").on("click","li",function() {
					var that = $(this);
					that.children()[0].className = "selected";
					that.siblings().children()[0].className = "choose";
					if(that.parent().attr("id") === "allergy") {
						if(that.val() === 1) {
							$("#allergy_detail").parent().show().trigger("focus");
						}
						else {
							$("#allergy_detail").parent().hide();
							$("#allergy").prev().removeClass("error");
						}
						fn._getInfo(init.curSufferer);
						fn._checkInfo(init.curSufferer);
					}
				});

				$("input").on("blur keyup",function() {
					fn._getInfo(init.curSufferer);
					fn._checkInfo(init.curSufferer);
					if(isValidate()) {
						$("#sbmt_info").parent().removeClass("no-handle");
					}
				});
				//点击提交按键的操作
				$("#sbmt_info").parent().on("click", function() {
					if(this.className.indexOf("no-handle") === -1) {
						fn._checkSucs(true);
					}
					else {
						alert("信息填写有误");
					}
				});
			})();
		</script>
	</body>
</html>
