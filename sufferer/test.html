<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<title>咨询详情</title>
		<link href="css/suffer-style.css?d=20160721" rel="stylesheet" type="text/css" />
		<script src="js/font-adjust.js" type="text/javascript" charset="utf-8"></script>

		<link rel="stylesheet" href="photoswipe.css"> 
		<link rel="stylesheet" href="default-skin.css"> 
		<script src="photoswipe.min.js"></script> 
		<script src="photoswipe-ui-default.min.js"></script>
	</head>
	<body>
		<div class="page" id="page">
			<!--ask process -->
			<section class="ask-process">
				<span class="icon"></span>
				<h3 id="ask_state"></h3>
				<!-- <p class="inline">等待医生的回复</p> -->
			</section>
			<!--ask detail-->
			<section class="ask-detail">
				<form action="" accept-charset="utf-8">
					<ul>
						<li class="team-clear">
							<p>患者姓名</p>
							<p>大婴孩</p>
						</li>
						<li class="team-clear">
							<p>年龄</p>
							<p>31</p>
						</li>
						<li class="team-clear">
							<p>手机号码</p>
							<p>1356584865</p>
						</li>
						<li class="team-clear">
							<p>性别</p>
							<p>女</p>
						</li>
					</ul>
					<div class="hr"></div>
					<ul class="ill-describe">
						<li class="team-clear">
							<p>药物过敏</p>
							<p>肠胃这几天不舒服，前两天带孩子去吃了海鲜，吃了正露丸肠胃这几天不舒服，前两天带孩子
							</p>

						</li>
						<li class="team-clear">
							<p>病情描述</p>
							<p>
								肠胃这几天不舒服，前两天带孩子去吃了海鲜，吃了正露丸肠胃这几天不舒服，前两天带孩子露丸肠胃这几天不舒服，前两天带孩子 .
							</p>
							<div id="disease-photo" class="my-gallery"></div>
						</li>
					</ul>
				</form>
			</section>
		</div>

		<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
		    <div class="pswp__bg"></div>
		    <div class="pswp__scroll-wrap">
		        <div class="pswp__container">
		            <div class="pswp__item"></div>
		            <div class="pswp__item"></div>
		            <div class="pswp__item"></div>
		        </div>
		        <div class="pswp__ui pswp__ui--hidden">
		            <div class="pswp__top-bar">
		               <div class="pswp__counter"></div>
		                <div class="pswp__preloader__icn">
		                </div>
		            </div>
		        </div>
		    </div>
		</div>

		<script src="js/zepto.js"></script>
		<script src="js/common.js"></script>
		<script>
			var util = {
				screenHgt : document.body.clientHeight,
				screenWid : document.body.clientWidth,
				states : ["咨询中","咨询已结束","已退款","正在退款"],
				photoWrp : $("#disease-photo"),
				bigImgCtnr : $("#big_img"),
				imgCount : 2,
				imgStore : [],
				count : 0,
				setState : function(state) {
					$("#ask_state").text(state);
				},
				//用容器包裹照片并添加至文档流中
				creatSlider : function(imgArray) {
					for (var i = 0,len=imgArray.length; i < len; i++) {
						var figure = document.createElement("figure");
						var a = document.createElement("a");
						a.href = imgArray[i].src;
						$(figure).append($(a));
						$(a).append(imgArray[i]);
						a.setAttribute('data-size', imgArray[i].width+'x'+imgArray[i].height);
						util.photoWrp.append($(figure));
					}
				},
				//在病情描述中添加照片
				creatImg : function(imgArray,num) {
					var img = document.createElement("img");
					img.src = imgArray[util.count];
					img.alt = "疾病照片";
					util.count += 1;
					img.onerror = function () {
						if (num >= util.imgCount) {
							return;
						}
						util.creatImg(imgArray, num);
					}
					img.onload = function () {
						util.imgStore.push(img);
						if (++num >= util.imgCount) {
							util.creatSlider(util.imgStore);
							return;
						}
						util.creatImg(imgArray, num);
					};
				},
			};
			//初始化设置
			util.setState(util.states[1]);
			util.creatImg(["images/artcl-icon.png","images/doctor-banner.jpg"],0);
			util.creatSlider(util.imgStore);

			//图片查看
			var initPhotoSwipeFromDOM = function(gallerySelector) {
			    var parseThumbnailElements = function(el) {
			        var thumbElements = el.childNodes,
			            numNodes = thumbElements.length,
			            items = [],
			            figureEl,
			            linkEl,
			            size,
			            item;
			        for(var i = 0; i < numNodes; i++) {
			            figureEl = thumbElements[i]; // <figure> element
			            // include only element nodes 
			            if(figureEl.nodeType !== 1) {
			                continue;
			            }
			            linkEl = figureEl.children[0]; // <a> element
			            size = linkEl.getAttribute('data-size').split('x');
			            // create slide object
			            item = {
			                src: linkEl.getAttribute('href'),
			                w: parseInt(size[0], 10),
			                h: parseInt(size[1], 10)
			            };
			            if(figureEl.children.length > 1) {
			                // <figcaption> content
			                item.title = figureEl.children[1].innerHTML; 
			            }

			            if(linkEl.children.length > 0) {
			                // <img> thumbnail element, retrieving thumbnail url
			                item.msrc = linkEl.children[0].getAttribute('src');
			            } 

			            item.el = figureEl; // save link to element for getThumbBoundsFn
			            items.push(item);
			        }

			        return items;
			    };
			    // find nearest parent element
			    var closest = function closest(el, fn) {
			        return el && ( fn(el) ? el : closest(el.parentNode, fn) );
			    };
			    // triggers when user clicks on thumbnail
			    var onThumbnailsClick = function(e) {
			        e = e || window.event;
			        e.preventDefault ? e.preventDefault() : e.returnValue = false;
			        var eTarget = e.target || e.srcElement;
			        // find root element of slide
			        var clickedListItem = closest(eTarget, function(el) {
			            return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
			        });
			        if(!clickedListItem) {
			            return;
			        }
			        var clickedGallery = clickedListItem.parentNode,
			            childNodes = clickedListItem.parentNode.childNodes,
			            numChildNodes = childNodes.length,
			            nodeIndex = 0,
			            index;
			        for (var i = 0; i < numChildNodes; i++) {
			            if(childNodes[i].nodeType !== 1) { 
			                continue; 
			            }

			            if(childNodes[i] === clickedListItem) {
			                index = nodeIndex;
			                break;
			            }
			            nodeIndex++;
			        }
			        if(index >= 0) {
			            // open PhotoSwipe if valid index found
			            openPhotoSwipe( index, clickedGallery );
			        }
			        return false;
			    };
			    // parse picture index and gallery index from URL (#&pid=1&gid=2)
			    var photoswipeParseHash = function() {
			        var hash = window.location.hash.substring(1),
			        params = {};
			        if(hash.length < 5) {
			            return params;
			        }
			        var vars = hash.split('&');
			        for (var i = 0; i < vars.length; i++) {
			            if(!vars[i]) {
			                continue;
			            }
			            var pair = vars[i].split('=');  
			            if(pair.length < 2) {
			                continue;
			            }           
			            params[pair[0]] = pair[1];
			        }
			        if(params.gid) {
			            params.gid = parseInt(params.gid, 10);
			        }
			        return params;
			    };

			    var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
			        var pswpElement = document.querySelectorAll('.pswp')[0],
			            gallery,
			            options,
			            items;
			        items = parseThumbnailElements(galleryElement);
			        // define options (if needed)
			        options = {
			            // define gallery index (for URL)
			            galleryUID: galleryElement.getAttribute('data-pswp-uid'),
			            getThumbBoundsFn: function(index) {
			                // See Options -> getThumbBoundsFn section of documentation for more info
			                var thumbnail = items[index].el.getElementsByTagName('img')[0], // find thumbnail
			                    pageYScroll = window.pageYOffset || document.documentElement.scrollTop,
			                    rect = thumbnail.getBoundingClientRect(); 
			                return {x:rect.left, y:rect.top + pageYScroll, w:rect.width};
			            }
			        };
			        options.mainClass = 'pswp--minimal--dark';
			        options.barsSize = {top:0,bottom:0};
					options.captionEl = false;
					options.fullscreenEl = false;
					options.shareEl = false;
					options.tapToClose = true;
					options.tapToToggleControls = false;
			        // PhotoSwipe opened from URL
			        if(fromURL) {
			            if(options.galleryPIDs) {
			                // parse real index when custom PIDs are used 
			                // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
			                for(var j = 0; j < items.length; j++) {
			                    if(items[j].pid == index) {
			                        options.index = j;
			                        break;
			                    }
			                }
			            } else {
			                // in URL indexes start from 1
			                options.index = parseInt(index, 10) - 1;
			            }
			        } else {
			            options.index = parseInt(index, 10);
			        }
			        // exit if index not found
			        if( isNaN(options.index) ) {
			            return;
			        }
			        if(disableAnimation) {
			            options.showAnimationDuration = 0;
			        }
			        // Pass data to PhotoSwipe and initialize it
			        gallery = new PhotoSwipe( pswpElement, PhotoSwipeUI_Default, items, options);
			        gallery.init();
			    };
			    // loop through all gallery elements and bind events
			    var galleryElements = document.querySelectorAll( gallerySelector );
			    for(var i = 0, l = galleryElements.length; i < l; i++) {
			        galleryElements[i].setAttribute('data-pswp-uid', i+1);
			        galleryElements[i].onclick = onThumbnailsClick;
			    }
			    // Parse URL and open gallery if it contains #&pid=3&gid=1
			    var hashData = photoswipeParseHash();
			    if(hashData.pid && hashData.gid) {
			        openPhotoSwipe( hashData.pid ,  galleryElements[ hashData.gid - 1 ], true, true );
			    }
			};
			initPhotoSwipeFromDOM('.my-gallery');
		</script>
	</body>
</html>
