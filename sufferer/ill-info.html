<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<title>请填写基本资料</title>
		<link href="css/suffer-style.css" rel="stylesheet" type="text/css" />
		<script src="js/font-adjust.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css" media="screen">
			
		</style>
	</head>
	<body>
		<!-- patient form-->
		<section class="patient-body body-minheight">
			<div class="patient-banner">
				<div class="patient-icon"></div>
				<h1>获得医生更准确地服务 </h1>
				<p>您的个人信息为保密状态，仅医患双方可见</p>
			</div>
			<form action="" class="patient-form" method="post" accept-charset="utf-8">
				<div class="line">
					<label><span>患者姓名</span><input type="text" id="name" placeholder="请填写患者名字"></label>
				</div>
				<div class="line">
					<label><span>出生年月</span><input type="date" id="yearMth" placeholder="请选择出生年月"></label>
				</div>
				<div class="line">
					<label><span>手机号码</span><input type="text" id="phone" placeholder="手机号用于接收医生回答提醒"></label>
				</div>
				<div class="line">
					<label>
						<span>性别</span>
						<ul id="sex">
							<li value="0"><div class="selected"></div>男</li>
							<li value="1"><div class="choose"></div>女</li>
						</ul>
					</label>
					
				</div>
				<div class="line">
					<label>
						<span>药物过敏</span>
						<ul id="allergy">
							<li value="0"><div class="selected"></div>无</li>
							<li value="1"><div class="choose"></div>有</li>
						</ul>
					</label><br>
					<label style="display: none;"><span>&nbsp;</span><input type="text" id="allergy_detail" style="margin-top: 0.2rem;"placeholder="请输入过敏药物名称"></label>
				</div>
			</form>
		</section>

		<div class="patient-btn no-handle">
			<a id="sbmt_info" href="#">提交</a>
		</div>

		<script src="js/zepto.js"></script>
		<script src="js/common.js"></script>
		<script>
			(function() {
				var init = {
					curSufferer : {},
				};
				var check = {
					_nullCheck : function(text,name) {
						if(text === "" || text === null) {
							$("#"+name).prev().addClass("error");
							$("#sbmt_info").parent().addClass("no-handle");
							return false;
						}
						$("#"+name).prev().removeClass("error");
						return true;
					},
					//电话号码的匹配，包括虚拟运营号码比如170等
					_phoneCheck : function(content,name) {
						var reg = /(^(13\d|15[^4,\D]|17[13678]|18\d)\d{8}|170[^346,\D]\d{7})$/;
						if(!reg.test(content)) {
							$("#"+name).prev().addClass("error");
							$("#sbmt_info").parent().addClass("no-handle");
							return false;
						}
						$("#"+name).prev().removeClass("error");
						return true;
					},
					//检查过敏描述为空
					_allergyCheck :function(allergy,name) {
						if(allergy === "" || allergy === null) {
							$("#"+name).prev().addClass("error");
							$("#sbmt_info").parent().addClass("no-handle");
							return false;
						}
						$("#"+name).prev().removeClass("error");
						return true;
					},
				};
				var fn = {
					_getInfo : function(surferer) {
						surferer.name = $("#name").val().trim();
						surferer.yearMth = $("#yearMth").val();
						surferer.phone = $("#phone").val().trim();
						surferer.sex = $("#sex .selected").parent().val();
						surferer.allergy = $("#allergy .selected").parent().val();
					},
					_checkInfo : function(surferer) {
						if(check._nullCheck(surferer.name,"name")) {
							if(check._nullCheck(surferer.yearMth,"yearMth")) {
								if(check._phoneCheck(surferer.phone,"phone")) {
									if(surferer.allergy === 1) {
										surferer.allergyDetl = $("#allergy_detail").val().trim();
										if(check._allergyCheck(surferer.allergyDetl,"allergy")) {
											return true;
										}
										else {
											return false;
										}
									}
									else {
										$("#sbmt_info").parent().removeClass("no-handle");
										delete surferer.allergyDetl;
										return true;
									}
								}
							}
						}
						return false;
					},
					//看之前是否有记录患者信息
					_cmtJudge : function(record) {
						if(!record) {
							window.location.href = "disease-desc.html";
						}
						else {
							window.location.href = "sufferer-choose.html";
						}
					},
					//检查输入正确后进行的操作
					_checkSucs : function(record) {
						this._cmtJudge(record);
					},

				};
				//判断是否有错误样式
				var isValidate = function() {
					if($(".error").length === 0) {
						return true;
					}
					return false;
				};

				//性别与过敏与否的选择
				$("#sex,#allergy").on("click","li",function() {
					var that = $(this);
					that.children()[0].className = "selected";
					that.siblings().children()[0].className = "choose";
					if(that.parent().attr("id") === "allergy") {
						if(that.val() === 1) {
							$("#allergy_detail").parent().show().trigger("focus");
							fn._getInfo(init.curSufferer);
							fn._checkInfo(init.curSufferer);
						}
						else {
							$("#allergy_detail").parent().hide();
							$("#allergy").prev().removeClass("error");
						}
					}
				});

				$("input").on("blur keyup",function() {
					fn._getInfo(init.curSufferer);
					fn._checkInfo(init.curSufferer);
					if(isValidate()) {
						$("#sbmt_info").parent().removeClass("no-handle");
					}
				});
				//点击提交按键的操作
				$("#sbmt_info").parent().on("click", function() {
					if(this.className.indexOf("no-handle") === -1) {
						fn._checkSucs(true);
					}
					else {
						alert("信息填写有误");
					}
				});
			})();
		</script>
	</body>
</html>
